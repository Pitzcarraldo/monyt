{"version":3,"sources":["../../../src/metrics/event/MemoryLeakMetrics.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAKqB;;;AACnB,WADmB,iBACnB,GAA0B;QAAd,gEAAU,kBAAI;wCADP,mBACO;;6FADP,+BACO;;AAExB,UAAK,IAAL,GAAY,YAAZ,CAFwB;AAGxB,UAAK,KAAL,GAAa,EAAb,CAHwB;AAIxB,UAAK,QAAL,GAAgB,QAAQ,QAAR,IAAoB,KAApB,CAJQ;AAKxB,UAAK,MAAL,GALwB;;GAA1B;;6BADmB;;6BASV;;;AACP,6BAAS,EAAT,CAAY,MAAZ,EAAoB,iBAAS;AAC3B,0DAAiC,KAAjC,EAD2B;AAE3B,eAAK,KAAL,GAAa,KAAb,CAF2B;AAG3B,YAAI,OAAK,QAAL,EAAe;AACjB,6BAAS,aAAT,CAAuB,UAAC,GAAD,EAAM,QAAN,EAAmB;AACxC,gBAAI,GAAJ,EAAS;AACP,2DAA4B,GAA5B,EADO;AAEP,qBAFO;aAAT;AAIA,6DAAgC,QAAhC,EALwC;WAAnB,CAAvB,CADiB;SAAnB;OAHkB,CAApB,CADO;;;;+BAgBE;AACT,UAAM,mCAAa,KAAK,KAAL,CAAb,CADG;AAET,WAAK,KAAL,GAAa,EAAb,CAFS;AAGT,aAAO,KAAP,CAHS;;;SAzBQ","file":"MemoryLeakMetrics.js","sourcesContent":["import memwatch from 'memwatch-next';\nimport heapdump from 'heapdump';\nimport Metrics from '../Metrics';\nimport warning from '../../warning';\n\nexport default class MemoryLeakMetrics extends Metrics {\n  constructor(options = {}) {\n    super();\n    this.name = 'memoryLeak';\n    this.value = {};\n    this.autoDump = options.autoDump || false;\n    this.listen();\n  }\n\n  listen() {\n    memwatch.on('leak', stats => {\n      warning(`Detected Memory Leaks ${stats}`);\n      this.value = stats;\n      if (this.autoDump) {\n        heapdump.writeSnapshot((err, filename) => {\n          if (err) {\n            warning(`Heap Dump Failed ${err}`);\n            return;\n          }\n          warning(`Heap Dump Written To ${filename}`);\n        });\n      }\n    });\n  }\n\n  getValue() {\n    const value = { ...this.value };\n    this.value = {};\n    return value;\n  }\n}\n"]}