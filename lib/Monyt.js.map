{"version":3,"sources":["../src/Monyt.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAIqB;;;;;;;;;;;;;AAYnB,WAZmB,KAYnB,GAA0B;QAAd,gEAAU,kBAAI;wCAZP,OAYO;;AACxB,SAAK,QAAL,GAAgB,QAAQ,QAAR,+BAAhB,CADwB;AAExB,SAAK,OAAL,GAAe,QAAQ,OAAR,IAAmB,EAAnB,CAFS;AAGxB,SAAK,QAAL,GAAgB,EAAhB,CAHwB;AAIxB,SAAK,UAAL,GAAkB,QAAQ,UAAR,IAAsB,2DAA2B,WAAS,UAAU,KAAK,QAAL,GAA9C,CAAtB,CAJM;AAKxB,YAAQ,MAAR,IAAkB,wBAAc,UAAd,CAAyB,QAAQ,MAAR,CAA3C,CALwB;GAA1B;;;;;;;;;;6BAZmB;;2BA0BZ,UAAU;;;AACf,aAAO,KAAK,UAAL,CAAgB,MAAhB,CAAuB,UAAC,SAAD,EAAc;AAC1C,oBAAY,SACV,kBAAQ,GAAR,CAAY,MAAK,OAAL,CAAa,GAAb,CAAiB;iBAAU,OAAO,IAAP,CAAY,SAAZ;SAAV,CAA7B,CADU,CAAZ,CAD0C;OAAd,CAA9B,CADe;;;;;;;;;;2BAYV;AACL,aAAO,KAAK,UAAL,CAAgB,IAAhB,EAAP,CADK;;;;;;;;;gCAOK;AACV,aAAO,wBAAc,SAAd,EAAP,CADU;;;;;;;;;kCAOE;AACZ,aAAO,CAAE,KAAK,UAAL,CAAgB,cAAhB,EAAF,EAAoC,wBAAc,aAAd,EAApC,CAAP,CADY;;;SApDK","file":"Monyt.js","sourcesContent":["import { DEFAULT_INTERVAL } from './constants';\nimport LoggerFactory from './logger/LoggerFactory';\nimport MetricsAggregator from './metrics/MetricsAggregator';\n\nexport default class Monyt {\n  /**\n   * @param {Object} [options={}] - Options to initialize Monyt.\n   * @param {string} [options.interval=30000] - Interval to listen aggregate.\n   * @param {Array<Metrics>} [options.metricses=[]] - List of Metrics to aggregate.\n   * @param {Array<Sender>} [options.senders=[]] - List of sender to send metricses.\n   * @param {Promise} [options.listener=new Promise()] - Listener of MetricsAggregator.\n   * @param {string} [options.prefix=''] - Prefix of metrics name.\n   * @param {Object} [options.aggregator=new MetricsAggregator({...options, interval: this.interval})] - Instance of MetricsAggregator.\n   * @param {Logger} [options.logger=LoggerFactory.FACTORY] - Logger Class to use.\n   * @return {Monyt} - new Monyt Instances.\n   */\n  constructor(options = {}) {\n    this.interval = options.interval || DEFAULT_INTERVAL;\n    this.senders = options.senders || [];\n    this.listener = '';\n    this.aggregator = options.aggregator || new MetricsAggregator({ ...options, interval: this.interval });\n    options.logger && LoggerFactory.setFactory(options.logger);\n  }\n\n  /**\n   * Start to aggregate and send metricses.\n   * Replace Console to default logger when replaceConsole is true.\n   * @param {Function} callback - callback function that returns result promises of senders.\n   * @returns {Number} - interval listener id.\n   */\n  listen(callback) {\n    return this.aggregator.listen((metricses)=> {\n      callback && callback(\n        Promise.all(this.senders.map(sender => sender.send(metricses)))\n      );\n    });\n  }\n\n  /**\n   * Stop to listen.\n   * @returns {Number} - result of clearListener.\n   */\n  stop() {\n    return this.aggregator.stop();\n  }\n\n  /**\n   * @returns {Logger} logger - Default logger instance.\n   */\n  getLogger() {\n    return LoggerFactory.getLogger();\n  }\n\n  /**\n   * @returns {Array} middlewares - List of middlewares to mark and log requests and errors.\n   */\n  middlewares() {\n    return [ this.aggregator.markMiddleware(), LoggerFactory.logMiddleware() ];\n  }\n}\n"]}